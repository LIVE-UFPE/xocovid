{% load static %}
<!-- Link: /App/ -->
<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="../static/filter.json"></script>

        <meta charset="utf-8">
        <title>XoCovid</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    
        <!-- * Vue imports -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
        <script src="https://unpkg.com/http-vue-loader"></script>
        <!-- esse /\ é o import que permite usar componentes em vue -->
        <!-- fim dos imports de Vue -->

        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/v-charts/lib/line.min.js"></script>

        <!-- * Leaflet imports -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
            integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
            crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
        <script src="{% static 'leaflet-heat.js' %}"></script>
        <!-- fim dos imports de Leaflet -->

        <style>
            .v-text-field, .v-btn {
        
                border-radius: 10px;
            }

            .sub-botao{
                font-size: 25px !important;
                font-weight: lighter;
                text-transform: none;
                letter-spacing: normal;
            }

            #top {
            font-family: Barlow, Helvetica, Arial, sans-serif;
            text-align: center;
            }

            #nav {
            padding: 30px;
            }

            #nav a {
            font-weight: bold;
            color: #2c3e50;
            }

            #nav a.router-link-exact-active {
            color: #42b983;
            }

            .round-border {
            border-radius: 23px !important;
            }
        </style>    
    </head>

    <body>
        <v-app id="app" >
            <v-content class="pa-0 ma-0" style="background-color: 'transparent'" fluid fill-height >
                {% block body_block %}
                {% endblock %}
            </v-content>
        </v-app>
    </body>
</html>

<script>
    var pins = {{ items_json|safe }};
    var predicts = {{ predicts_json|safe }};
    //confirmados
    var bairroBase = {{ bairroBase|safe }}
    var cidadeBase = {{ cidadeBase|safe }}
    var estadoBase = {{ estadoBase|safe }}
    //suspeitos
    var estadoBaseS = {{ estadoBaseS|safe }}
    var cidadeBaseS = {{ cidadeBaseS|safe }}
    var bairroBaseS = {{ bairroBaseS|safe }}
    //Suspeitos acumulados
    var estadoBaseSA = {{ estadoBaseSA|safe }}
    var cidadeBaseSA = {{ cidadeBaseSA|safe }}
    var bairroBaseSA = {{ bairroBaseSA|safe }}
    //Confirmados acumulados
    var estadoBaseA = {{ estadoBaseA|safe }}
    var cidadeBaseA = {{ cidadeBaseA|safe }}
    var bairroBaseA = {{ bairroBaseA|safe }}
    // obitos por dia e acumulado
    var obitosBase = {{ obitosBase|safe }}
    var obitosBaseA = {{ obitosBaseA|safe }}

    console.log("Obitos: ", obitosBase, obitosBaseA)

    const app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        vuetify: new Vuetify({
            theme: {
                themes: {
                    light: {
                        primary: '#1E9CF8', // Blue
                        secondary: '#FFFFFF', //White
                        accent: '#82B1FF',
                        error: '#FF5252',
                        info: '#2196F3',
                        success: '#4CAF50',
                        warning: '#FFC107'
                    },
                },
            },
        }),
        components: {
            // ? esse é o metodo para importar componentes em Vue
            'login': httpVueLoader("{% static 'vue-views/login.vue' %}"),
            'covid-map': httpVueLoader("{% static 'vue-views/covidMap.vue' %}"),
            VeLine
        // usando /\ como o nome da tag no código HTML (exemplo: <main-app></main-app>) 
        },
        data: () => ({
            itemsChips: [],
            itemsChipsC: [],
            itemsChipsD: [],
            itemsChipsS: [],
            itemsChipsCS: [],
            itemsChipsDS: [],
            itemsChipsSA: [],
            itemsChipsCSA: [],
            itemsChipsDSA: [],
            itemsChipsA: [],
            itemsChipsO: [],
            itemsChipsCA: [],
            itemsChipsDA: [],
            itemsChipsR: [],
            itemsChipsSelect: ['Casos Confirmados', 'Casos Suspeitos', 'Óbitos'],
            values: ['Pernambuco'],
            valuesC:  null,
            valuesD: null,
            valuesS: ['Pernambuco'],
            valuesCS:  null,
            valuesDS: null,
            valuesA: ['Pernambuco'],
            valuesCA:  null,
            valuesDA: null,
            valuesR: null,
            valuesSelect: null,
            value: null,
            sheet: false,
            base: 0,
            activeBtn: 1,
            item: 5,
            items: [
                {
                avatar: 'https://cdn.vuetifyjs.com/images/lists/1.jpg',
                title: 'Brunch this weekend?',
                subtitle: "<span class='text--primary'>Ali Connors</span> &mdash; I'll be in your neighborhood doing errands this weekend. Do you want to hang out?",
                },
                {
                avatar: 'https://cdn.vuetifyjs.com/images/lists/2.jpg',
                title: 'Summer BBQ <span class="grey--text text--lighten-1">4</span>',
                subtitle: "<span class='text--primary'>to Alex, Scott, Jennifer</span> &mdash; Wish I could come, but I'm out of town this weekend.",
                },
                {
                avatar: 'https://cdn.vuetifyjs.com/images/lists/3.jpg',
                title: 'Oui oui',
                subtitle: "<span class='text--primary'>Sandra Adams</span> &mdash; Do you have Paris recommendations? Have you ever been?",
                },
                {
                avatar: 'https://cdn.vuetifyjs.com/images/lists/4.jpg',
                title: 'Birthday gift',
                subtitle: "<span class='text--primary'>Trevor Hansen</span> &mdash; Have any ideas about what we should get Heidi for her birthday?",
                },
                {
                avatar: 'https://cdn.vuetifyjs.com/images/lists/5.jpg',
                title: 'Recipe to try',
                subtitle: "<span class='text--primary'>Britta Holt</span> &mdash; We should eat this: Grate, Squash, Corn, and tomatillo Tacos.",
                },
            ],
            chartDataS: {},
            chartDataSA: {},
            chartDataA: {},
            chartData: {},
            chartDataO: {},
            icons: [
                'mdi-download',
                'fab fa-twitter',
                'fab fa-google-plus',
                'fab fa-linkedin',
                'fab fa-instagram',
            ],
            disabled: false,
            dense: false,
            twoLine: false,
            threeLine: false,
            shaped: false,
            flat: false,
            subheader: false,
            inactive: false,
            subGroup: false,
            nav: false,
            avatar: false,
            rounded: false,
            pins: pins,
            datedb: new Date(),
            predicts: predicts,
            useIa: false,
            diaOUAcu: 'acumulado'
        }),
        
        methods: {
            printName: function (value){
                console.log("Teste ", value);
            },
            setCity: function (value, chips){
                var objC = [];
                value.forEach(selecao =>{
                    data[0].estados.forEach(estado => {
                        if(estado.nome == selecao){
                            objC = objC.concat(estado.cidades)
                        }    
                    });
                });
                Vue.set(app, chips, objC)
            },
            setDistrict: function (value, chips){
                var objD = [];
                value.forEach(selecao => {
                    data[0].bairros.forEach(cidade => {
                        console.log("Cidade e value", cidade, Object.keys(cidade), value)
                        if(Object.keys(cidade)[0] == selecao){
                            objD = objD.concat(cidade[Object.keys(cidade)[0]]);
                        }
                    });
                });
                console.log("CHIPS: ",chips);
                Vue.set(app, chips, objD)
            },
            filterControl: function(value, valuesC, valuesB, selecao, diaouacu){
                if(selecao == 'Casos Suspeitos' && diaouacu == 'acumulado'){
                    this.filterSA(value, valuesC, valuesB)
                }else if(selecao == 'Casos Confirmados' && diaouacu == 'acumulado'){
                    this.filterA(value, valuesC, valuesB)
                }else if(selecao == 'Casos Suspeitos' && diaouacu == 'diario'){
                    this.filterS(value, valuesC, valuesB, 'chartDataSA')
                }
                else if(selecao == 'Casos Confirmados' && diaouacu == 'diario'){
                    this.filter(value, valuesC, valuesB, 'chartDataSA')
                }
                else if(selecao == 'Óbito' && diaouacu == 'diario'){

                }
                else if(selecao == 'Óbito' && diaouacu == 'acumulado'){

                }
            },
            filterO: function(){
                var object = []
                var chart = {
                    rows: [],
                    columns: ['data', 'Óbitos', 'Óbitos Acumulados']
                }
                object = [...obitosBase]
                
                console.log('Obitos ', object,obitosBase, obitosBaseA)
                obitosBase.forEach((obj,index) => {
                    obitosBase[index]['estado_residencia'] = "Óbitos"
                    obitosBase.forEach((obj2, index2) => {
                        if(index2 > index){
                            if(obj['data_notificacao'] == obj2['data_notificacao']){
                                obitosBase[index]['quantidade_casos'] += obitosBase[index2]['quantidade_casos']                                
                                obitosBase.splice(index2, 1)
                            }
                        }
                    })
                    
                })
                
                var object2 = []
                // obitosBase.forEach(valor => object2.push(valor))
                var i=0
                for(i=0;i<obitosBase.length; i++){
                    object2.push(obitosBase[i])
                }
                var obj3 = []
                object2.forEach((valor, index) => {
                    object2[index]['estado_residencia'] = "Óbitos Acumulados"
                    obj3.push(object2[index]['quantidade_casos'])
                    if(index != 0){
                        object2[index]['quantidade_casos'] += object2[index-1]['quantidade_casos'] 
                    }
                    chart.rows.push({'Óbitos Acumulados' : object2[index]['quantidade_casos'],
                                            'data' : object2[index]['data_notificacao'], 'Óbitos':obj3[index]})
                    
                })
                console.log('Charts: ', chart, obj3)
                Vue.set(app, 'chartDataO', chart)
            },
            filterSA: function (value, valuesC, valuesB){
                value = ['Pernambuco']
                var chart = {
                    columns: ['data'],
                    rows: []
                }
                
                if(value == null || value == []){
                    console.log("Nada");
                }else if(valuesC == null || (valuesC.length == 0)){
                    //pesquisa por estado                    

                    value.forEach(estado =>{
                        estadoBaseSA.forEach(estadob =>{
                            if(estado.toLowerCase() == estadob.estado_residencia.toLowerCase()){
                                if(! chart.columns.includes(estado.toLowerCase())){
                                    chart.columns.push(estado.toLowerCase())
                                }
                                // console.log("inclui ", chart.rows)
                                if(chart.rows.length == 0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : (estadob.data_notificacao)
                                    })
                                }
                                var i= 0
                                chart.rows.forEach((element, index) =>{
                                    if(element.data == estadob.data_notificacao){
                                        chart.rows[index] = Object.assign({[estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao},element)
                                        i=1;
                                    }
                                    
                                })
                                if(i==0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao
                                    })
                                }
                            }
                        })
                    })
                }
                else if(valuesC != null && (valuesC.length != 0)){ 
                    if(valuesB == null || (valuesB.length == 0)){ //pesquisa cidade
                        valuesC.forEach(cidade =>{
                            cidadeBaseSA.forEach(cidadeb =>{
                                if(cidade.toLowerCase() == cidadeb.municipio.toLowerCase()){
                                    if(! chart.columns.includes(cidade.toLowerCase())){
                                        chart.columns.push(cidade.toLowerCase())
                                    }
                                    // console.log("inclui ", chart.rows)
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == cidadeb.data_notificacao){
                                            chart.rows[index] = Object.assign({[cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao},element)
                                            i=1;
                                        }
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }else{ //pesquisa bairro
                        valuesB.forEach(bairro =>{
                            bairroBaseSA.forEach(bairrob =>{
                                if(bairro.toLowerCase() == bairrob.bairro.toLowerCase()){
                                    if(! chart.columns.includes(bairro.toLowerCase())){
                                        chart.columns.push(bairro.toLowerCase())
                                    }
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == bairrob.data_notificacao){
                                            chart.rows[index] = Object.assign({[bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao},element)
                                            i=1;
                                        }
                                        
                                    })
                                    console.log("Dados append: ", chart.rows)
                                    if(i==0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }
                }
                chart.rows.sort(function(a, b){ 
                    const yearA = parseInt(a.data[6]+a.data[7]+a.data[8]+a.data[9])
                    const monthA = parseInt(a.data[3]+a.data[4])
                    const dayA = parseInt(a.data[0]+a.data[1])
                    const yearB = parseInt(b.data[6]+b.data[7]+b.data[8]+b.data[9])
                    const monthB = parseInt(b.data[3]+b.data[4])
                    const dayB = parseInt(b.data[0]+b.data[1])
                    return new Date(yearA, monthA, dayA) - new Date(yearB, monthB, dayB); 
                }); 
                console.log("Chart: ", chart);
                Vue.set(app, 'chartDataSA', chart)
            },
            filterA: function (value, valuesC, valuesB){
                value = ['Pernambuco']
                var chart = {
                    columns: ['data'],
                    rows: []
                }
                
                if(value == null || value == []){
                    console.log("Nada");
                }else if(valuesC == null || (valuesC.length == 0)){
                    //pesquisa por estado                    

                    value.forEach(estado =>{
                        estadoBaseA.forEach(estadob =>{
                            if(estado.toLowerCase() == estadob.estado_residencia.toLowerCase()){
                                if(! chart.columns.includes(estado.toLowerCase())){
                                    chart.columns.push(estado.toLowerCase())
                                }
                                // console.log("inclui ", chart.rows)
                                if(chart.rows.length == 0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : (estadob.data_notificacao)
                                    })
                                }
                                var i= 0
                                chart.rows.forEach((element, index) =>{
                                    if(element.data == estadob.data_notificacao){
                                        chart.rows[index] = Object.assign({[estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao},element)
                                        i=1;
                                    }
                                })
                                if(i==0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao
                                    })
                                }
                            }
                        })
                    })
                }
                else if(valuesC != null && (valuesC.length != 0)){ 
                    if(valuesB == null || (valuesB.length == 0)){ //pesquisa cidade
                        valuesC.forEach(cidade =>{
                            cidadeBaseA.forEach(cidadeb =>{
                                if(cidade.toLowerCase() == cidadeb.municipio.toLowerCase()){
                                    if(! chart.columns.includes(cidade.toLowerCase())){
                                        chart.columns.push(cidade.toLowerCase())
                                    }
                                    // console.log("inclui ", chart.rows)
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == cidadeb.data_notificacao){
                                            chart.rows[index] = Object.assign({[cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao},element)
                                            i=1;
                                        }
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }else{ //pesquisa bairro
                        valuesB.forEach(bairro =>{
                            bairroBaseA.forEach(bairrob =>{
                                if(bairro.toLowerCase() == bairrob.bairro.toLowerCase()){
                                    if(! chart.columns.includes(bairro.toLowerCase())){
                                        chart.columns.push(bairro.toLowerCase())
                                    }
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == bairrob.data_notificacao){
                                            chart.rows[index] = Object.assign({[bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao},element)
                                            i=1;
                                        }
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }
                }
                chart.rows.sort(function(a, b){ 
                    const yearA = parseInt(a.data[6]+a.data[7]+a.data[8]+a.data[9])
                    const monthA = parseInt(a.data[3]+a.data[4])
                    const dayA = parseInt(a.data[0]+a.data[1])
                    const yearB = parseInt(b.data[6]+b.data[7]+b.data[8]+b.data[9])
                    const monthB = parseInt(b.data[3]+b.data[4])
                    const dayB = parseInt(b.data[0]+b.data[1])
                    return new Date(yearA, monthA, dayA) - new Date(yearB, monthB, dayB); 
                }); 
                console.log("Chart: ", chart);
                Vue.set(app, 'chartDataSA', chart)
            },
            filterS: function (value, valuesC, valuesB, graph){
                value = ['Pernambuco']
                var chart = {
                    columns: ['data'],
                    rows: []
                }
                
                if(value == null || value == []){
                    console.log("Nada");
                }else if(valuesC == null || (valuesC.length == 0)){
                    //pesquisa por estado                    

                    value.forEach(estado =>{
                        estadoBaseS.forEach(estadob =>{
                            if(estado.toLowerCase() == estadob.estado_residencia.toLowerCase()){
                                if(! chart.columns.includes(estado.toLowerCase())){
                                    chart.columns.push(estado.toLowerCase())
                                }
                                // console.log("inclui ", chart.rows)
                                if(chart.rows.length == 0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : (estadob.data_notificacao)
                                    })
                                }
                                var i= 0
                                chart.rows.forEach((element, index) =>{
                                    if(element.data == estadob.data_notificacao){
                                        chart.rows[index] = Object.assign({[estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao},element)
                                        i=1;
                                    }
                                    
                                })
                                if(i==0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao
                                    })
                                }
                            }
                        })
                    })
                }
                else if(valuesC != null && (valuesC.length != 0)){ 
                    if(valuesB == null || (valuesB.length == 0)){ //pesquisa cidade
                        valuesC.forEach(cidade =>{
                            cidadeBaseS.forEach(cidadeb =>{
                                if(cidade.toLowerCase() == cidadeb.municipio.toLowerCase()){
                                    if(! chart.columns.includes(cidade.toLowerCase())){
                                        chart.columns.push(cidade.toLowerCase())
                                    }
                                    // console.log("inclui ", chart.rows)
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == cidadeb.data_notificacao){
                                            chart.rows[index] = Object.assign({[cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao},element)
                                            i=1;
                                        }
                                       
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }else{ //pesquisa bairro
                        valuesB.forEach(bairro =>{
                            bairroBaseS.forEach(bairrob =>{
                                if(bairro.toLowerCase() == bairrob.bairro.toLowerCase()){
                                    if(! chart.columns.includes(bairro.toLowerCase())){
                                        chart.columns.push(bairro.toLowerCase())
                                    }
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == bairrob.data_notificacao){
                                            chart.rows[index] = Object.assign({[bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao},element)
                                            i=1;
                                        }
                                        
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }
                }
                chart.columns.forEach(elemento => {
                    chart.rows.forEach( (row, index) => {
                         if(row[elemento] != null && row[elemento] != undefined || elemento == 'data'){
                            //console.log("Testando: ", row[elemento], row.length)
                         }else{
                            chart.rows[index] = Object.assign(row,{[elemento.toLowerCase()] : 0})
                         }
                    })
                    
                })
                chart.rows.sort(function(a, b){ 
                    const yearA = parseInt(a.data[6]+a.data[7]+a.data[8]+a.data[9])
                    const monthA = parseInt(a.data[3]+a.data[4])
                    const dayA = parseInt(a.data[0]+a.data[1])
                    const yearB = parseInt(b.data[6]+b.data[7]+b.data[8]+b.data[9])
                    const monthB = parseInt(b.data[3]+b.data[4])
                    const dayB = parseInt(b.data[0]+b.data[1])
                    return new Date(yearA, monthA, dayA) - new Date(yearB, monthB, dayB); 
                }); 
                console.log("Chart: ", chart)
                Vue.set(app, graph, chart)
            },
            filter: function (value, valuesC, valuesB, graph){
                value = ['Pernambuco']
                var chart = {
                    columns: ['data'],
                    rows: []
                }
                console.log("ValuesC: ", valuesC)
                if(value == null || value == []){
                    console.log("Nada");
                }else if(valuesC == null || (valuesC.length == 0)){
                    //pesquisa por estado                    

                    value.forEach(estado =>{
                        estadoBase.forEach(estadob =>{
                            if(estado.toLowerCase() == estadob.estado_residencia.toLowerCase()){
                                if(! chart.columns.includes(estado.toLowerCase())){
                                    chart.columns.push(estado.toLowerCase())
                                }
                                // console.log("inclui ", chart.rows)
                                if(chart.rows.length == 0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : (estadob.data_notificacao)
                                    })
                                }
                                var i= 0
                                chart.rows.forEach((element, index) =>{
                                    if(element.data == estadob.data_notificacao){
                                        chart.rows[index] = Object.assign({[estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao},element)
                                        i=1;
                                    }
                                    
                                })
                                if(i==0){
                                    chart.rows.push({
                                        [estado.toLowerCase()] : estadob.quantidade_casos,
                                        'data' : estadob.data_notificacao
                                    })
                                }
                            }
                        })
                    })
                }
                else if(valuesC != null && (valuesC.length != 0)){ 
                    if(valuesB == null || (valuesB.length == 0)){ //pesquisa cidade
                        valuesC.forEach(cidade =>{
                            cidadeBase.forEach(cidadeb =>{
                                if(cidade.toLowerCase() == cidadeb.municipio.toLowerCase()){
                                    if(! chart.columns.includes(cidade.toLowerCase())){
                                        chart.columns.push(cidade.toLowerCase())
                                    }
                                    // console.log("inclui ", chart.rows)
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == cidadeb.data_notificacao){
                                            chart.rows[index] = Object.assign({[cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao},element)
                                            i=1;
                                        }
                                        
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [cidade.toLowerCase()] : cidadeb.quantidade_casos,
                                            'data' : cidadeb.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }else{ //pesquisa bairro
                        valuesB.forEach(bairro =>{
                            bairroBase.forEach(bairrob =>{
                                if(bairro.toLowerCase() == bairrob.bairro.toLowerCase()){
                                    if(! chart.columns.includes(bairro.toLowerCase())){
                                        chart.columns.push(bairro.toLowerCase())
                                    }
                                    // console.log("inclui ", chart.rows)
                                    if(chart.rows.length == 0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                    var i= 0
                                    chart.rows.forEach((element, index) =>{
                                        if(element.data == bairrob.data_notificacao){
                                            chart.rows[index] = Object.assign({[bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao},element)
                                            i=1;
                                        }
                                        
                                    })
                                    if(i==0){
                                        chart.rows.push({
                                            [bairro.toLowerCase()] : bairrob.quantidade_casos,
                                            'data' : bairrob.data_notificacao
                                        })
                                    }
                                }
                            })
                        })
                    }
                }

                chart.columns.forEach(elemento => {
                    chart.rows.forEach( (row, index) => {
                         if(row[elemento] != null && row[elemento] != undefined || elemento == 'data'){
                            //console.log("Testando: ", row[elemento], row.length)
                         }else{
                            chart.rows[index] = Object.assign({[elemento.toLowerCase()] : 0},row)
                         }
                    })
                    
                })
                chart.rows.sort(function(a, b){ 
                    const yearA = parseInt(a.data[6]+a.data[7]+a.data[8]+a.data[9])
                    const monthA = parseInt(a.data[3]+a.data[4])
                    const dayA = parseInt(a.data[0]+a.data[1])
                    const yearB = parseInt(b.data[6]+b.data[7]+b.data[8]+b.data[9])
                    const monthB = parseInt(b.data[3]+b.data[4])
                    const dayB = parseInt(b.data[0]+b.data[1])
                    // console.log("DataA: ", a.data, b.data, dataA)
                    return new Date(yearA, monthA, dayA) - new Date(yearB, monthB, dayB); 
                }); 
                console.log("Chart: ", chart);
                Vue.set(app, graph, chart)
            },
            dateBack: function (event) {
                let test = new Date(this.datedb);
                test.setDate( test.getDate() - 1 );
                test.setHours(23,59,58);

                let today = new Date();
                today.setHours(23,59,59);
                if( test < today ){
                    this.useIa = false;
                    console.log("não usando mais predições!")
                }

                this.datedb = test;
                console.log("voltando um dia!("+this.datedb.toLocaleString('en-GB')+")");
            },
            dateForward: function (event) {
                let test = new Date(this.datedb);
                test.setDate( test.getDate() + 1 );
                let today = new Date();
                today.setHours(23,59,59);
                let tomorrow = new Date(today);
                tomorrow.setDate( today.getDate() + 1 );

                // se estou além de meia noite de hj e antes de meia noite de amanha
                if(test > today && test < tomorrow ) {
                    console.log("entrando nas predições!");
                    this.useIa = true;
                    this.datedb = test;
                }else if(test < today){
                    this.datedb = test;
                    console.log("avançando um dia!("+this.datedb.toLocaleString('en-GB')+")");
                }else {
                    console.log("não podemos avançar mais do que amanhã!");
                }
            }
        },
        mounted: function () {
            this.$nextTick(function () {
                this.filterS(['Pernambuco'], [], [], 'chartDataS')
                this.filter(['Pernambuco'], [], [], 'chartData')
                this.filterSA(['Pernambuco'], [], [])
                this.filterO()
            })
        },
    });
    //Filter module
    var obj = [];
    data[0].estados.forEach(estado => {
        obj.push(estado.nome);
        
    });
    // console.log("Data: ", obj)
    Vue.set(app, 'itemsChips', obj)
    Vue.set(app, 'itemsChipsS', obj)
    Vue.set(app, 'itemsChipsSA', obj)
    Vue.set(app, 'itemsChipsA', obj)
    // console.log("Values: ", value, values);
    //Filter module city
</script>
